<!-- Loading State -->
<div *ngIf="loading()" class="container py-5">
  <div class="text-center">
    <div class="spinner-border vtth-text-primary" role="status">
      <span class="visually-hidden">Đang tải...</span>
    </div>
  </div>
</div>

<!-- Article Content -->
<div *ngIf="!loading() && article()" class="container py-4 py-md-5">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a routerLink="/" class="text-decoration-none">Trang chủ</a>
      </li>
      <li class="breadcrumb-item">
        <a routerLink="/news" class="text-decoration-none">Tin tức</a>
      </li>
      <li class="breadcrumb-item">
        <a [routerLink]="['/news']" [queryParams]="{category: article()!.categorySlug}" class="text-decoration-none">
          {{ article()!.category }}
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ article()!.title }}
      </li>
    </ol>
  </nav>

  <div class="row g-4">
    <!-- Main Article -->
    <div class="col-12 col-lg-8">
      <article class="card border-0 shadow-sm">
        <!-- Article Header Image -->
        <div class="position-relative">
          <img
            [src]="article()!.image"
            [alt]="article()!.title"
            class="card-img-top w-100"
            style="height: 400px; object-fit: cover;"
          />
          <span class="badge vtth-bg-primary position-absolute top-0 start-0 m-3">
            {{ article()!.category }}
          </span>
        </div>

        <!-- Article Body -->
        <div class="card-body p-4 p-md-5">
          <!-- Title -->
          <h1 class="fw-bold mb-4 vtth-text-primary" style="font-size: 2rem; line-height: 1.3;">
            {{ article()!.title }}
          </h1>

          <!-- Meta Information -->
          <div class="d-flex flex-wrap align-items-center gap-3 mb-4 pb-3 border-bottom">
            <div class="d-flex align-items-center gap-2 text-muted">
              <i class="bi bi-calendar-event"></i>
              <span>{{ formatDate(article()!.date) }}</span>
            </div>
            <div *ngIf="article()!.author" class="d-flex align-items-center gap-2 text-muted">
              <i class="bi bi-person"></i>
              <span>{{ article()!.author }}</span>
            </div>
            <div *ngIf="article()!.views" class="d-flex align-items-center gap-2 text-muted">
              <i class="bi bi-eye"></i>
              <span>{{ article()!.views }} lượt xem</span>
            </div>
          </div>

          <!-- Tags -->
          <div *ngIf="article()?.tags && article()!.tags!.length > 0" class="mb-4">
            <i class="bi bi-tags me-2 vtth-text-primary"></i>
            <span
              *ngFor="let tag of article()!.tags!; let last = last"
              class="badge bg-light text-dark me-2 mb-2"
            >
              {{ tag }}
            </span>
          </div>

          <!-- Article Content -->
          <div class="article-content" [innerHTML]="article()!.content" style="font-size: 1.1rem; line-height: 1.8; color: #333;">
          </div>

          <!-- Share Buttons -->
          <div class="mt-5 pt-4 border-top">
            <h5 class="fw-bold mb-3">Chia sẻ bài viết:</h5>
            <div class="d-flex flex-wrap gap-2">
              <button
                class="btn vtth-btn vtth-btn-primary"
                (click)="shareOnFacebook()"
              >
                <i class="bi bi-facebook me-2"></i>Facebook
              </button>
              <button
                class="btn vtth-btn vtth-btn-info"
                (click)="shareOnZalo()"
              >
                <i class="bi bi-chat-dots me-2"></i>Zalo
              </button>
              <button
                class="btn vtth-btn vtth-btn-secondary"
                (click)="shareOnTwitter()"
              >
                <i class="bi bi-twitter me-2"></i>Twitter
              </button>
              <button
                class="btn vtth-btn vtth-btn-success"
                (click)="copyLink()"
              >
                <i class="bi bi-link-45deg me-2"></i>Sao chép link
              </button>
            </div>
          </div>
        </div>
      </article>

      <!-- Related Articles -->
      <section *ngIf="relatedArticles().length > 0" class="mt-5">
        <h3 class="fw-bold mb-4 vtth-text-primary">
          <i class="bi bi-newspaper me-2"></i>Bài viết liên quan
        </h3>
        <div class="row g-4">
          <div
            *ngFor="let article of relatedArticles(); trackBy: trackById"
            class="col-12 col-md-6"
          >
            <div class="card border-0 shadow-sm h-100 overflow-hidden transition">
              <img
                [src]="article.image"
                [alt]="article.title"
                class="card-img-top"
                style="height: 180px; object-fit: cover;"
              />
              <div class="card-body d-flex flex-column">
                <span class="badge vtth-bg-primary mb-2 small">{{ article.category }}</span>
                <h5 class="card-title fw-bold mb-2">
                  <a
                    [routerLink]="['/news', article.slug]"
                    class="text-decoration-none text-dark"
                  >
                    {{ article.title }}
                  </a>
                </h5>
                <p class="card-text text-muted small flex-grow-1 mb-3">
                  {{ article.excerpt }}
                </p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    {{ formatDate(article.date) }}
                  </small>
                  <a
                    [routerLink]="['/news', article.slug]"
                    class="btn btn-sm vtth-btn vtth-btn-primary"
                  >
                    Đọc thêm
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Sidebar -->
    <aside class="col-12 col-lg-4">
      <!-- Quick Actions -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header vtth-bg-primary text-white border-0 p-3">
          <h5 class="m-0 fw-bold">Dịch vụ nhanh</h5>
        </div>
        <div class="card-body p-0">
          <ul class="list-unstyled m-0">
            <li class="border-bottom">
              <a
                routerLink="/dat-lich-kham"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-calendar-check me-2 vtth-text-primary"></i>
                Đặt lịch khám bệnh
              </a>
            </li>
            <li class="border-bottom">
              <a
                routerLink="/experts"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-person-badge me-2 vtth-text-primary"></i>
                Đội ngũ chuyên gia
              </a>
            </li>
            <li class="border-bottom">
              <a
                routerLink="/about-us"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-building me-2 vtth-text-primary"></i>
                Giới thiệu bệnh viện
              </a>
            </li>
            <li>
              <a
                routerLink="/news"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-arrow-left me-2 vtth-text-primary"></i>
                Quay lại danh sách tin tức
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Category Navigation -->
      <div class="card border-0 shadow-sm">
        <div class="card-header vtth-bg-secondary text-white border-0 p-3">
          <h5 class="m-0 fw-bold">Danh mục tin tức</h5>
        </div>
        <div class="card-body p-0">
          <ul class="list-unstyled m-0">
            <li class="border-bottom">
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'tin-noi-bat'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-star-fill me-2 vtth-text-secondary"></i>
                Tin nổi bật
              </a>
            </li>
            <li class="border-bottom">
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'tin-hoat-dong'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-building me-2 vtth-text-secondary"></i>
                Tin hoạt động bệnh viện
              </a>
            </li>
            <li class="border-bottom">
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'tin-trong-nganh'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-newspaper me-2 vtth-text-secondary"></i>
                Tin trong ngành
              </a>
            </li>
            <li class="border-bottom">
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'bai-viet-chuyen-mon'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-journal-text me-2 vtth-text-secondary"></i>
                Bài viết chuyên môn
              </a>
            </li>
            <li class="border-bottom">
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'thong-bao-moi-thau'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-megaphone me-2 vtth-text-secondary"></i>
                Thông báo & Mời thầu
              </a>
            </li>
            <li class="border-bottom">
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'y-hoc-thuong-thuc'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-heart-pulse me-2 vtth-text-secondary"></i>
                Y học thường thức
              </a>
            </li>
            <li>
              <a
                [routerLink]="['/news']"
                [queryParams]="{category: 'ky-thuat-moi'}"
                class="d-block p-3 text-decoration-none text-dark transition"
              >
                <i class="bi bi-cpu me-2 vtth-text-secondary"></i>
                Kỹ thuật mới triển khai
              </a>
            </li>
          </ul>
        </div>
      </div>
    </aside>
  </div>
</div>

<!-- Not Found -->
<div *ngIf="!loading() && !article()" class="container py-5">
  <div class="text-center">
    <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
    <h2 class="mt-3">Không tìm thấy bài viết</h2>
    <p class="text-muted mb-4">Bài viết bạn đang tìm kiếm không tồn tại hoặc đã bị xóa.</p>
    <a routerLink="/news" class="btn vtth-btn vtth-btn-primary">
      <i class="bi bi-arrow-left me-2"></i>Quay lại danh sách tin tức
    </a>
  </div>
</div>

