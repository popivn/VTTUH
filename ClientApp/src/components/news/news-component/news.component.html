<!-- HERO CAROUSEL SECTION -->
<section class="py-4 py-md-5 bg-light">
  <div class="container">
    <!-- Search Bar -->
    <div class="row mb-4">
      <div class="col-12 col-lg-8 mx-auto">
        <div class="input-group input-group-lg shadow-sm">
          <span class="input-group-text bg-white border-end-0">
            <i class="bi bi-search vtth-text-primary"></i>
          </span>
          <input
            type="text"
            class="form-control border-start-0"
            placeholder="Tìm kiếm tin tức..."
            [value]="searchQuery()"
            (input)="searchQuery.set($any($event.target).value)"
            (keyup.enter)="onSearch()"
          />
          <button
            class="btn vtth-btn vtth-btn-primary"
            type="button"
            (click)="onSearch()"
          >
            Tìm kiếm
          </button>
        </div>
      </div>
    </div>

    <!-- Featured Carousel -->
    <div *ngIf="featuredArticles().length > 0" class="mb-5">
      <div id="newsCarousel" class="carousel slide carousel-fade shadow-lg rounded-4 overflow-hidden" data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button
            *ngFor="let article of featuredArticles().slice(0, 5); let i = index"
            type="button"
            [attr.data-bs-target]="'#newsCarousel'"
            [attr.data-bs-slide-to]="i"
            [class.active]="i === 0"
            [attr.aria-current]="i === 0 ? 'true' : null"
            [attr.aria-label]="'Slide ' + (i + 1)"
          ></button>
        </div>
        <div class="carousel-inner">
          <div
            *ngFor="let article of featuredArticles().slice(0, 5); let i = index"
            class="carousel-item"
            [class.active]="i === 0"
          >
            <div class="position-relative" style="height: 400px; max-height: 60vh;">
              <img
                [src]="article.image"
                [alt]="article.title"
                class="d-block w-100 h-100 object-fit-cover"
              />
              <div class="carousel-caption d-none d-md-block text-start" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); bottom: 0; left: 0; right: 0; padding: 2rem;">
                <div class="container">
                  <span class="badge vtth-bg-primary mb-2">{{ article.category }}</span>
                  <h2 class="fw-bold text-white mb-3" style="font-size: 2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                    {{ article.title }}
                  </h2>
                  <p class="text-white-50 mb-4" style="font-size: 1.1rem;">
                    {{ truncate(article.excerpt, 150) }}
                  </p>
                  <a
                    [routerLink]="['/news', article.slug]"
                    class="btn vtth-btn vtth-btn-danger rounded-pill px-4 py-2"
                  >
                    Đọc thêm <i class="bi bi-arrow-right ms-2"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#newsCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#newsCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- MAIN CONTENT SECTION -->
<section class="py-4 py-md-5">
  <div class="container">
    <div class="row g-4">
      <!-- Main Content -->
      <div class="col-12 col-lg-8">
        <!-- Category Filters -->
        <div class="mb-4">
          <div class="d-flex flex-wrap gap-2">
            <button
              *ngFor="let cat of categories"
              type="button"
              class="vtth-btn"
              [class.vtth-btn-primary]="selectedCategory() === cat.slug"
              [class.vtth-btn-secondary]="selectedCategory() !== cat.slug"
              [class.active]="selectedCategory() === cat.slug"
              (click)="handleCategoryClick(cat.slug)"
            >
              <i [class]="cat.icon + ' me-2'"></i>
              {{ cat.label }}
            </button>
          </div>
        </div>

        <!-- Results Count -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <p class="text-muted mb-0">
            Tìm thấy <strong>{{ filteredArticles().length }}</strong> bài viết
            <span *ngIf="selectedCategory() !== 'all'">
              trong danh mục <strong>{{ currentCategoryLabel() }}</strong>
            </span>
          </p>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading()" class="text-center py-5">
          <div class="spinner-border vtth-text-primary" role="status">
            <span class="visually-hidden">Đang tải...</span>
          </div>
        </div>

        <!-- News Grid -->
        <div *ngIf="!loading() && paginatedArticles().length > 0" class="row g-4 mb-4">
          <div
            *ngFor="let article of paginatedArticles(); trackBy: trackById"
            class="col-12 col-md-6"
          >
            <div class="card border-0 shadow-sm h-100 overflow-hidden transition">
              <div class="position-relative">
                <img
                  [src]="article.image"
                  [alt]="article.title"
                  class="card-img-top"
                  style="height: 200px; object-fit: cover;"
                />
                <span class="badge vtth-bg-primary position-absolute top-0 start-0 m-2">
                  {{ article.category }}
                </span>
              </div>
              <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold mb-2 text-balance">
                  <a
                    [routerLink]="['/news', article.slug]"
                    class="text-decoration-none text-dark"
                  >
                    {{ article.title }}
                  </a>
                </h5>
                <p class="card-text text-muted small flex-grow-1 mb-3">
                  {{ truncate(article.excerpt, 100) }}
                </p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <i class="bi bi-calendar-event me-1"></i>
                    {{ formatDate(article.date) }}
                  </small>
                  <a
                    [routerLink]="['/news', article.slug]"
                    class="btn btn-sm vtth-btn vtth-btn-primary"
                  >
                    Đọc thêm
                  </a>
                </div>
                <div *ngIf="article.tags && article.tags.length > 0" class="mt-2">
                  <small class="text-muted">
                    <i class="bi bi-tags me-1"></i>
                    <span *ngFor="let tag of article.tags.slice(0, 3); let last = last">
                      {{ tag }}<span *ngIf="!last">, </span>
                    </span>
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Results -->
        <div *ngIf="!loading() && paginatedArticles().length === 0" class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted"></i>
          <p class="text-muted mt-3">Không tìm thấy bài viết nào</p>
          <button
            class="btn vtth-btn vtth-btn-primary"
            (click)="handleCategoryClick('all'); searchQuery.set('')"
          >
            Xem tất cả tin tức
          </button>
        </div>

        <!-- Pagination -->
        <nav *ngIf="totalPages() > 1" aria-label="Phân trang tin tức">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage() === 1">
              <a
                class="page-link"
                href="#"
                (click)="$event.preventDefault(); onPageChange(currentPage() - 1)"
                aria-label="Trang trước"
              >
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li
              *ngFor="let page of [].constructor(totalPages()); let i = index"
              class="page-item"
              [class.active]="currentPage() === i + 1"
            >
              <a
                class="page-link"
                href="#"
                (click)="$event.preventDefault(); onPageChange(i + 1)"
              >
                {{ i + 1 }}
              </a>
            </li>
            <li class="page-item" [class.disabled]="currentPage() === totalPages()">
              <a
                class="page-link"
                href="#"
                (click)="$event.preventDefault(); onPageChange(currentPage() + 1)"
                aria-label="Trang sau"
              >
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Sidebar -->
      <aside class="col-12 col-lg-4">
        <!-- Popular Articles -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header vtth-bg-primary text-white border-0 p-3">
            <h5 class="m-0 fw-bold">
              <i class="bi bi-fire me-2"></i>Tin xem nhiều nhất
            </h5>
          </div>
          <div class="card-body p-0">
            <ul class="list-unstyled m-0">
              <li
                *ngFor="let article of popularArticles(); let i = index; trackBy: trackById"
                class="border-bottom"
              >
                <a
                  [routerLink]="['/news', article.slug]"
                  class="d-block p-3 text-decoration-none text-dark transition"
                >
                  <div class="d-flex align-items-start gap-3">
                    <span class="badge vtth-bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 24px; height: 24px; font-size: 0.75rem; flex-shrink: 0;">
                      {{ i + 1 }}
                    </span>
                    <div class="flex-grow-1">
                      <h6 class="fw-bold mb-1 small">{{ article.title }}</h6>
                      <small class="text-muted">
                        <i class="bi bi-eye me-1"></i>{{ article.views }} lượt xem
                      </small>
                    </div>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Newsletter Subscription -->
        <div class="card border-0 shadow-sm mb-4 vtth-bg-primary text-white">
          <div class="card-body p-4">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-envelope-paper me-2"></i>Đăng ký nhận tin
            </h5>
            <p class="small mb-3">Nhận thông tin mới nhất về tin tức và sự kiện qua email</p>
            <div class="input-group">
              <input
                type="email"
                class="form-control"
                placeholder="Nhập email của bạn"
                [value]="newsletterEmail()"
                (input)="newsletterEmail.set($any($event.target).value)"
              />
              <button
                class="btn btn-light"
                type="button"
                (click)="onSubscribeNewsletter()"
              >
                <i class="bi bi-send"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Upcoming Events -->
        <div class="card border-0 shadow-sm">
          <div class="card-header vtth-bg-secondary text-white border-0 p-3">
            <h5 class="m-0 fw-bold">
              <i class="bi bi-calendar-event me-2"></i>Sự kiện sắp tới
            </h5>
          </div>
          <div class="card-body p-0">
            <ul class="list-unstyled m-0">
              <li
                *ngFor="let event of upcomingEvents()"
                class="border-bottom p-3"
              >
                <h6 class="fw-bold mb-2 small">{{ event.title }}</h6>
                <div class="d-flex align-items-center gap-2 text-muted small">
                  <i class="bi bi-calendar3"></i>
                  <span>{{ formatDate(event.date) }}</span>
                </div>
                <div class="d-flex align-items-center gap-2 text-muted small mt-1">
                  <i class="bi bi-clock"></i>
                  <span>{{ event.time }}</span>
                </div>
                <div class="d-flex align-items-center gap-2 text-muted small mt-1">
                  <i class="bi bi-geo-alt"></i>
                  <span>{{ event.location }}</span>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>

