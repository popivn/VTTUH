<!-- Hero Section -->
<section class="py-5" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8 mx-auto text-center text-white">
        <nav aria-label="breadcrumb" class="mb-3">
          <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a routerLink="/" class="text-white-50">Trang chủ</a></li>
            <li class="breadcrumb-item"><a routerLink="/vaccination" class="text-white-50">Tiêm chủng</a></li>
            <li class="breadcrumb-item active text-white" aria-current="page">Tình hình Vaccin</li>
          </ol>
        </nav>
        <h1 class="display-5 fw-bold mb-3">
          <i class="bi bi-capsule me-3"></i>Tình hình Vaccin
        </h1>
        <p class="lead mb-0 opacity-90">
          Cập nhật tình trạng vaccine hiện có tại bệnh viện
        </p>
      </div>
    </div>
  </div>
</section>

<div class="container py-5">
  <!-- Search and Filter -->
  <div class="card border-0 shadow-sm rounded-4 mb-4">
    <div class="card-body p-4">
      <div class="row g-3 align-items-center">
        <div class="col-lg-6">
          <div class="input-group input-group-lg">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input type="text" class="form-control border-start-0 ps-0" 
                   placeholder="Tìm kiếm vaccine..."
                   (input)="onSearch($event)">
          </div>
        </div>
        <div class="col-lg-6">
          <div class="d-flex flex-wrap gap-2">
            <button *ngFor="let cat of categories"
                    class="btn rounded-pill px-3"
                    [class.btn-primary]="selectedCategory() === cat.id"
                    [class.btn-outline-secondary]="selectedCategory() !== cat.id"
                    (click)="setCategory(cat.id)">
              <i [class]="'bi ' + cat.icon + ' me-1'"></i>
              {{ cat.label }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Summary -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm rounded-3 h-100">
        <div class="card-body text-center py-3">
          <div class="fw-bold fs-4 text-success">{{ (vaccines | json).split('"available"').length - 1 }}</div>
          <small class="text-muted">Còn hàng</small>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm rounded-3 h-100">
        <div class="card-body text-center py-3">
          <div class="fw-bold fs-4 text-warning">{{ (vaccines | json).split('"limited"').length - 1 }}</div>
          <small class="text-muted">Sắp hết</small>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm rounded-3 h-100">
        <div class="card-body text-center py-3">
          <div class="fw-bold fs-4 text-danger">{{ (vaccines | json).split('"out"').length - 1 }}</div>
          <small class="text-muted">Hết hàng</small>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm rounded-3 h-100">
        <div class="card-body text-center py-3">
          <div class="fw-bold fs-4 text-info">{{ (vaccines | json).split('"coming"').length - 1 }}</div>
          <small class="text-muted">Đang nhập</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Vaccine List -->
  <div class="row g-4">
    <div *ngFor="let vaccine of filteredVaccines" class="col-12 col-md-6 col-lg-4">
      <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden service-card-hover">
        <div class="card-header border-0 py-3 px-4 d-flex justify-content-between align-items-center"
             [style.background]="vaccine.status === 'available' ? 'linear-gradient(135deg, #10B981, #059669)' : (vaccine.status === 'limited' ? 'linear-gradient(135deg, #F59E0B, #D97706)' : (vaccine.status === 'out' ? 'linear-gradient(135deg, #EF4444, #DC2626)' : 'linear-gradient(135deg, #3B82F6, #2563EB)'))">
          <span class="badge bg-white bg-opacity-25 rounded-pill text-white">
            <i [class]="'bi ' + vaccine.icon + ' me-1'"></i>
            {{ vaccine.target }}
          </span>
          <span class="badge bg-white text-dark rounded-pill">{{ vaccine.statusText }}</span>
        </div>
        <div class="card-body p-4">
          <h5 class="fw-bold mb-2" style="color: #4F46E5;">{{ vaccine.name }}</h5>
          <p class="text-muted small mb-3">
            <i class="bi bi-building me-1"></i>{{ vaccine.manufacturer }}
          </p>
          
          <div class="row g-2 mb-3">
            <div class="col-6">
              <div class="bg-light rounded-3 p-2 text-center">
                <small class="text-muted d-block">Độ tuổi</small>
                <strong class="small">{{ vaccine.ageGroup }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="bg-light rounded-3 p-2 text-center">
                <small class="text-muted d-block">Số mũi</small>
                <strong class="small">{{ vaccine.doses }} mũi</strong>
              </div>
            </div>
          </div>
          
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <small class="text-muted">Giá/mũi:</small>
              <div class="fw-bold" [class.text-success]="vaccine.price === 0" style="color: #8B5CF6;">
                {{ formatPrice(vaccine.price) }}
              </div>
            </div>
            <div *ngIf="vaccine.status === 'available' || vaccine.status === 'limited'">
              <small class="text-muted d-block text-end">Còn lại</small>
              <strong [class.text-warning]="vaccine.quantity < 100">{{ vaccine.quantity }} liều</strong>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 p-4 pt-0">
          <a routerLink="/dat-lich-kham" 
             class="btn w-100 rounded-pill text-white"
             [class.disabled]="vaccine.status === 'out' || vaccine.status === 'coming'"
             [style.background]="vaccine.status === 'available' ? 'linear-gradient(135deg, #8B5CF6, #7C3AED)' : (vaccine.status === 'limited' ? 'linear-gradient(135deg, #F59E0B, #D97706)' : '#6B7280')">
            <i class="bi bi-calendar-check me-2"></i>
            {{ vaccine.status === 'out' ? 'Hết hàng' : (vaccine.status === 'coming' ? 'Đang nhập' : 'Đặt lịch tiêm') }}
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredVaccines.length === 0" class="text-center py-5">
    <i class="bi bi-search display-1 text-muted"></i>
    <h4 class="mt-3 text-muted">Không tìm thấy vaccine phù hợp</h4>
    <p class="text-muted">Thử thay đổi bộ lọc hoặc từ khóa tìm kiếm</p>
  </div>
</div>

